<!DOCTYPE html>
<html lang="es" data-theme="dark">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Teacher English Planner (PWA) — MEDUCA v3</title>
  <meta name="theme-color" content="#0A7AFE" />
  <style>
    :root { --bg:#0b0b0b; --fg:#f0f0f0; --card:#121212; --border:#333; --btn:#0A7AFE; --btn2:#1f2937; --preview:#0f1115; --preview-fg:#e6edf3; }
    html[data-theme="light"]:root { --bg:#ffffff; --fg:#1f2937; --card:#f7f7f8; --border:#cfd2d6; --btn:#0A7AFE; --btn2:#e5e7eb; --preview:#ffffff; --preview-fg:#111827; }
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu; background:var(--bg); color:var(--fg); margin:0}
    main{padding:16px; max-width:1100px; margin:0 auto}
    .card{background:var(--card); border-radius:12px; padding:16px; box-shadow:0 2px 10px #0002; margin-bottom:12px}
    label{display:block; margin:8px 0 4px; font-weight:600}
    input, select, textarea{width:100%; padding:10px; border-radius:8px; border:1px solid var(--border); background:transparent; color:inherit}
    .grid{display:grid; grid-template-columns:repeat(auto-fit,minmax(240px,1fr)); gap:12px}
    .actions{display:flex; gap:8px; flex-wrap:wrap}
    .btn{background:var(--btn); color:#fff; border:none; padding:10px 14px; border-radius:10px; font-weight:700; cursor:pointer}
    .btn.secondary{background:var(--btn2); color:inherit}
    .preview{white-space:pre-wrap; background:var(--preview); color:var(--preview-fg); padding:12px; border-radius:10px; overflow:auto; max-height:40vh}
    table.schedule{width:100%; border-collapse:collapse}
    table.schedule th, table.schedule td{border:1px solid var(--border); padding:8px}
    details{border:1px solid var(--border); border-radius:8px; padding:8px}
    .ok{color:#22c55e} .fail{color:#ef4444}
  </style>
</head>
<body>
  <main>
    <section class="card">
      <div style="display:flex; justify-content:space-between; align-items:center">
        <div>
          <h1 style="margin:0">Teacher English Planner (PWA)</h1>
          <p style="margin:4px 0 0">v3: Panel de estado, guardar configuración, fechas/tiempos por lección y exportación oficial (Theme/ Lesson) a Word/PDF.</p>
        </div>
        <button id="themeToggle" class="btn secondary" title="Cambiar tema">Modo claro</button>
      </div>
    </section>

    <section class="card">
      <h3>Datos institucionales</h3>
      <div class="actions" style="margin-bottom:8px">
        <button class="btn" id="saveDefaults">Guardar configuración</button>
        <button class="btn secondary" id="loadDefaults">Cargar configuración</button>
        <button class="btn secondary" id="clearCache">Borrar caché del SW</button>
      </div>
      <div class="grid">
        <div><label>School</label><input id="school" type="text" placeholder="CEBG Barrigón" /></div>
        <div><label>Teacher</label><input id="teacher" type="text" placeholder="José White" /></div>
        <div><label>School Year</label><input id="schoolYear" type="text" placeholder="2026" /></div>
        <div><label>Trimester</label><select id="term"><option>1</option><option>2</option><option>3</option></select></div>
        <div><label>Weekly Hours</label><input id="weeklyHours" type="text" placeholder="3" /></div>
        <div><label>Weeks (range)</label><input id="weeks" type="text" placeholder="From week __ to week __" /></div>
        <div><label>CEFR Level</label><input id="cefr" type="text" placeholder="Pre-A1 / A1 / A2" /></div>
      </div>
    </section>

    <section class="card">
      <h3>Selección curricular</h3>
      <div class="grid">
        <div>
          <label>Grade</label>
          <select id="grade">
            <option value="Pre-K">Pre-Kinder</option>
            <option value="K">Kinder</option>
            <option value="1">Grade 1</option>
            <option value="2">Grade 2</option>
            <option value="3" selected>Grade 3</option>
            <option value="4">Grade 4</option>
            <option value="5">Grade 5</option>
            <option value="6">Grade 6</option>
          </select>
        </div>
        <div>
          <label>Scenario</label>
          <select id="scenario"></select>
        </div>
        <div>
          <label>Theme</label>
          <select id="theme"></select>
        </div>
      </div>
      <label style="margin-top:12px">Context</label>
      <textarea id="context" rows="3" placeholder="Grupo de primaria panameña; recursos básicos."></textarea>
    </section>

    <section class="card">
      <h3>Fechas y tiempos por lección</h3>
      <table class="schedule">
        <thead><tr><th>Lección</th><th>Fecha</th><th>Tiempo (min)</th></tr></thead>
        <tbody>
          <tr><td>Lesson 1</td><td><input id="L1_date" type="text" placeholder="2026-01-10"/></td><td><input id="L1_time" type="text" placeholder="40"/></td></tr>
          <tr><td>Lesson 2</td><td><input id="L2_date" type="text" placeholder="2026-01-12"/></td><td><input id="L2_time" type="text" placeholder="40"/></td></tr>
          <tr><td>Lesson 3</td><td><input id="L3_date" type="text" placeholder="2026-01-14"/></td><td><input id="L3_time" type="text" placeholder="40"/></td></tr>
          <tr><td>Lesson 4</td><td><input id="L4_date" type="text" placeholder="2026-01-16"/></td><td><input id="L4_time" type="text" placeholder="40"/></td></tr>
          <tr><td>Lesson 5</td><td><input id="L5_date" type="text" placeholder="2026-01-18"/></td><td><input id="L5_time" type="text" placeholder="40"/></td></tr>
        </tbody>
      </table>
    </section>

    <section class="card">
      <h3>Acciones</h3>
      <div class="actions">
        <button class="btn" id="generate">Generar Preview Markdown</button>
        <button class="btn secondary" id="exportThemeDoc">Theme Planner (Word .doc)</button>
        <button class="btn secondary" id="exportThemePdf">Theme Planner (PDF)</button>
        <button class="btn secondary" id="exportLessonsDoc">Lesson Planner 1–5 (Word .doc)</button>
        <button class="btn secondary" id="exportLessonsPdf">Lesson Planner 1–5 (PDF)</button>
      </div>
    </section>

    <section class="card">
      <h3>Vista previa (Markdown)</h3>
      <div id="preview" class="preview"></div>
      <textarea id="output" class="sr-only" aria-hidden="true"></textarea>
    </section>

    <section class="card">
      <h3>Panel de estado</h3>
      <details open>
        <summary>JSON y rutas</summary>
        <ul id="statusList"></ul>
      </details>
    </section>
  </main>

  <script>
    // Toggle tema
    (function(){
      const html=document.documentElement,btn=document.getElementById('themeToggle');
      const saved=localStorage.getItem('theme')||'dark';
      html.setAttribute('data-theme',saved);
      btn.textContent=saved==='dark'?'Modo claro':'Modo oscuro';
      document.querySelector('meta[name="theme-color"]').setAttribute('content',saved==='dark'?'#0A7AFE':'#ffffff');
      btn.addEventListener('click',()=>{const cur=html.getAttribute('data-theme')==='dark'?'light':'dark'; html.setAttribute('data-theme',cur); localStorage.setItem('theme',cur); btn.textContent=cur==='dark'?'Modo claro':'Modo oscuro'; document.querySelector('meta[name="theme-color"]').setAttribute('content',cur==='dark'?'#0A7AFE':'#ffffff');});
    })();
  </script>

  <script src="agents/english_agent/templates/md2doc_official.js"></script>
  <script src="app/app.js"></script>
</body>
</html>
